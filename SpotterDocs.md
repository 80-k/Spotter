# Spotter 앱 설계 및 아키텍처 문서

## 1. 개요

Spotter는 효율적인 운동 트래킹과 관리를 위한 iOS 애플리케이션입니다. 사용자가 운동 루틴을 계획하고, 운동 세션을 추적하며, 휴식 시간을 관리할 수 있도록 설계되었습니다. 특히 실시간 활동(LiveActivity) 기능을 통해 사용자가 앱을 활성화하지 않고도 운동 진행 상황과 휴식 시간을 모니터링할 수 있는 기능을 제공합니다.

## 2. 기술 스택

- **언어**: Swift
- **플랫폼**: iOS
- **UI 프레임워크**: SwiftUI
- **데이터 관리**: SwiftData
- **비동기 처리**: Combine, Swift Concurrency (async/await)
- **기타**: ActivityKit (LiveActivity), NotificationCenter, AppStorage

## 3. 아키텍처

Spotter 앱은 클린 아키텍처 원칙을 기반으로 설계되었으며, MVVM(Model-View-ViewModel) 패턴을 주로 사용합니다. 아키텍처는 다음 주요 계층으로 구성됩니다:

### 3.1 도메인 계층 (Domain Layer)

비즈니스 로직과 모델을 포함하며, 앱의 핵심 기능을 정의합니다.

- **모델 (Models)**: 앱의 핵심 데이터 구조 정의
  - `WorkoutSession`: 운동 세션 정보
  - `WorkoutTemplate`: 운동 템플릿 정의
  - `WorkoutSet`: 각 운동 세트의 상세 정보
  - `ExerciseItem`: 개별 운동 항목 정보
  - `MuscleGroup`: 근육 그룹 정의

- **유스케이스 (UseCases)**: 비즈니스 로직 구현
  - 운동 세션 관리
  - 운동 템플릿 관리
  - 휴식 타이머 관리

- **리포지토리 (Repositories)**: 데이터 액세스 추상화

### 3.2 데이터 계층 (Data Layer)

데이터 저장 및 관리를 담당합니다.

- **SwiftData**: 모델 영속성 제공
- **SwiftDataManager**: 데이터 관리 및 스키마 정의

### 3.3 프레젠테이션 계층 (Presentation Layer)

사용자 인터페이스와 상호작용을 담당합니다.

- **Views**: SwiftUI 기반 사용자 인터페이스
  - 탭별 화면 구조 (시작, 활성 운동, 히스토리, 설정)
  - 컴포넌트 및 재사용 가능한 뷰

- **ViewModels**: 뷰 로직 및 상태 관리
  - 데이터 변환 및 포맷팅
  - 사용자 인터랙션 처리

### 3.4 코어 계층 (Core Layer)

앱 전반에 걸쳐 사용되는 공통 서비스와 유틸리티를 제공합니다.

- **LiveActivity**: 실시간 활동 관리
- **AppState**: 앱 상태 관리
- **Theme**: 테마 및 시각적 스타일 관리
- **Timer**: 타이머 로직 관리
- **Auth**: 인증 관련 기능
- **Logging**: 로깅 및 디버깅 지원

## 4. 주요 기능

### 4.1 운동 템플릿 관리

- 운동 템플릿 생성, 수정, 삭제
- 운동 항목 추가/제거
- 템플릿 공유 및 가져오기

### 4.2 운동 세션 관리

- 템플릿 기반 운동 세션 시작
- 세트 추적 및 완료 상태 관리
- 휴식 시간 관리
- 운동 통계 기록

### 4.3 휴식 타이머

- 세트 간 휴식 시간 설정 및 관리
- 타이머 알림 제공
- LiveActivity를 통한 실시간 타이머 표시

### 4.4 LiveActivity 통합

- 운동 모드와 휴식 모드 간의 원활한 전환
- 운동 진행 상황 실시간 표시
- 휴식 타이머 실시간 카운트다운
- 앱 백그라운드 상태에서도 정보 표시

### 4.5 테마 및 UI 개인화

- 다크/라이트 모드 지원
- 사용자 지정 테마 옵션
- 접근성 설정

## 5. 디자인 원칙

### 5.1 모듈성 (Modularity)

- 기능별로 명확하게 분리된 모듈 구조
- 의존성 최소화 및 의존성 주입 활용
- 인터페이스와 구현의 분리

### 5.2 확장성 (Scalability)

- 새로운 기능을 쉽게 추가할 수 있는 구조
- 프로토콜 지향 설계로 컴포넌트 교체 용이성 확보

### 5.3 유지보수성 (Maintainability)

- 일관된 코드 스타일 및 명명 규칙
- 적절한 주석 및 문서화
- 단위 테스트 지원 구조

### 5.4 성능 (Performance)

- 효율적인 데이터 액세스 패턴
- 비동기 작업 최적화
- 배터리 효율성 고려

## 6. 데이터 모델

### 6.1 핵심 모델

#### WorkoutTemplate
- 이름, 설명 등의 기본 정보
- 포함된 운동 항목 목록
- 생성 및 수정 일자

#### ExerciseItem
- 운동 이름, 설명, 유형
- 근육 그룹 지정
- 기본 무게 및 반복 횟수 설정

#### WorkoutSession
- 시작 및 종료 시간
- 총 운동 시간
- 관련 템플릿 정보
- 완료된 세트 및 총 세트 수
- 총 무게 통계

#### WorkoutSet
- 무게 및 반복 횟수
- 완료 상태
- 휴식 시간 설정
- 관련 운동 항목 정보

### 6.2 SwiftData 스키마

SwiftData는 앱의 데이터 영속성을 관리하며, 다음과 같은 모델이 정의되어 있습니다:
- ExerciseItem
- WorkoutTemplate
- WorkoutSession
- WorkoutSet

## 7. 주요 서비스

### 7.1 LiveActivityService

LiveActivity 기능을 관리하는 핵심 서비스로, 운동 모드와 휴식 타이머 모드 간의 전환을 처리합니다.

- **ActivityMode 열거형**:
  - `workoutMode`: 일반 운동 모드
  - `restTimerMode`: 휴식 타이머 모드
  - `fadeInWorkoutMode`: 휴식에서 운동 모드로 전환 중
  - `fadeInRestTimerMode`: 운동에서 휴식 모드로 전환 중

- **주요 메서드**:
  - `startWorkoutActivity`: 운동 활동 시작
  - `updateWorkoutActivity`: 운동 정보 업데이트
  - `startRestTimerActivity`: 휴식 타이머 시작
  - `updateRestTimerActivity`: 휴식 타이머 업데이트
  - `switchToWorkoutMode`: 운동 모드로 전환
  - `endActivity`: 활동 종료

### 7.2 AppStateService

앱의 전반적인 상태를 관리하는 서비스입니다.

- 현재 ScenePhase 관리
- 앱 상태 변경 이벤트 처리
- 앱 라이프사이클 관리

### 7.3 ThemeService

앱의 시각적 테마를 관리합니다.

- 다크/라이트 모드 전환
- 사용자 정의 테마 설정
- 테마 변경 이벤트 처리

### 7.4 SwiftDataManager

SwiftData 모델 컨테이너를 관리하는 서비스입니다.

- 데이터 스키마 정의
- 모델 구성 설정
- 공유 모델 컨테이너 제공

## 8. 사용자 인터페이스 구조

### 8.1 주요 화면

- **온보딩**: 앱 최초 실행 시 사용자 안내
- **인증**: 로그인 및 계정 관리
- **메인 탭 뷰**: 앱의 주요 네비게이션 구조
  - **시작 탭**: 템플릿 선택 및 세션 시작
  - **활성 운동 화면**: 현재 진행 중인 운동 관리
  - **히스토리 탭**: 과거 운동 기록 확인
  - **설정 탭**: 앱 설정 및 사용자 프로필 관리

### 8.2 컴포넌트

- 재사용 가능한 UI 컴포넌트
- 템플릿 헤더 뷰
- 운동 세트 카드
- 휴식 타이머 뷰

## 9. 동시성 및 비동기 처리

### 9.1 Swift Concurrency

- async/await를 활용한 비동기 코드 구현
- Task를 통한 비동기 작업 관리
- 적절한 에러 처리 및 취소 메커니즘

### 9.2 @Sendable 적용

- 비동기 클로저에서 안전한 값 캡처
- Sendable 프로토콜 준수를 통한 타입 안전성 확보
- 동시성 관련 버그 방지

## 10. 설계 최적화

### 10.1 메모리 관리

- 메모리 누수 방지를 위한 약한 참조 사용
- 적절한 라이프사이클 관리
- 리소스 해제 보장

### 10.2 성능 최적화

- 불필요한 UI 업데이트 최소화
- 효율적인 데이터 로딩 및 캐싱
- 백그라운드 작업 최적화

### 10.3 배터리 사용량 최적화

- 백그라운드 처리 최소화
- 센서 및 타이머 사용 최적화
- LiveActivity 효율적 사용

## 11. 향후 개선 방향

### 11.1 기능 확장

- 사용자 간 템플릿 공유 기능
- 고급 통계 분석 및 시각화
- 게임화 요소 도입

### 11.2 인프라 개선

- 클라우드 동기화 기능 강화
- 백엔드 서비스 통합
- 성능 모니터링 도구 도입

### 11.3 플랫폼 확장

- iPad 최적화
- watchOS 지원 확대
- 웨어러블 기기 연동 강화

## 12. 결론

Spotter 앱은 현대적인 iOS 개발 기술과 패턴을 활용하여 사용자에게 편리하고 효과적인 운동 트래킹 경험을 제공합니다. 클린 아키텍처와 모듈식 설계를 통해 지속적인 개선과, 기능 확장이 용이한 구조를 갖추고 있으며, 특히 LiveActivity와 같은 최신 iOS 기능을 활용하여 차별화된 사용자 경험을 제공합니다.

앞으로도 사용자 피드백을 반영하고 iOS 플랫폼의 발전에 맞춰 지속적으로 개선해 나갈 계획입니다.
